<?php//error_reporting(E_ALL ) ;ini_set('max_execution_time', 0);ini_set('memory_limit', -1); set_time_limit(0);//ignore_user_abort(TRUE);include_once(__dir__.DIRECTORY_SEPARATOR."core.function.php") ;include_once (__dir__.DIRECTORY_SEPARATOR.'mYaml.class.php') ;$LocalSAE = "\n\nLocalSAE> " ;//判断本地环境根目录是否有中文if(preg_match('/[\x80-\xff]./', __DIR__)){	register_shutdown_function(function(){		echo iconv('UTF-8','GBK','遇到致命错误！').PHP_EOL;		passthru('msg %username% /time:60 "'.iconv('UTF-8','GBK','SAEPHP模拟环境目录中含有中文，不能继续，请将SAE本地模拟环境放在不含中文的目录中！').'"');	});	die(iconv('UTF-8','GBK',"SAEPHP模拟环境目录中含有中文，不能继续，请将SAE本地模拟环境放在不含中文的目录中！\n"));}echo iconv('UTF-8','GBK','SAE本地模拟开发环境正在启动...').PHP_EOL;$local_sae = new Loacl_SAE() ;//本地开发环境自动升级$local_sae->local_upgrade() ;//获取禁用的函数和禁用的类$local_sae->get_disable_function_class() ;//检查SAE中的配置文件$local_sae->chick_config() ;//启动apache$local_sae->start_apache() ;//启动redis$local_sae->start_redis() ;$redis_path = realpath(__DIR__. DIRECTORY_SEPARATOR .'..'.DIRECTORY_SEPARATOR."bin". DIRECTORY_SEPARATOR .'redis-2.0.2') ;$temp_dir = sys_get_temp_dir() ;$temp_dir = trim($temp_dir) ;run('"'.$redis_path. DIRECTORY_SEPARATOR .'redis-server.exe" '.$temp_dir.DIRECTORY_SEPARATOR.'redis.conf',"正在启动Redis服务...\n",$redisresources,true);$i = 0 ;while(!$local_sae->chickPort($local_sae->confs["redis_port"]) && $i<90){	sleep(1) ;	$i++ ;}if($i >= 90)	{	$local_sae->shutdown_function("redis服务启动失败，请您稍后再试。") ;}unset($i) ;echo iconv('UTF-8','GBK',"redis服务启动成功\n\n") ;//启动本地开发环境$local_sae->start_local_env() ;echo $LocalSAE ;$stdin = fopen("php://stdin", "rb");while ($read = fread($stdin, 1024)){	$command = array() ;	$read = trim($read) ;	if($read == "")	{		echo "\nLocalSAE> " ;	}	else	{		$command = $local_sae->analyze_read($read) ;		switch(strtolower($command[0]))		{		case 'showsae': //主要用户本地开发环境的开发与调试			var_dump($local_sae->local_env) ;			echo $LocalSAE ;			break ;		case 'capp':			if(count($command)==2)			{				if(preg_match("/^[a-zA-Z0-9]{4,18}$/",$command[1]) != 1)				{					echo iconv('UTF-8','GBK',"应用名称中只能有数字和字母，并且应用名长度应该在4-18个字符之间").$LocalSAE ;					break ;				}				if(count($local_sae->local_env)  >= $local_sae->appnum)				{					echo iconv('UTF-8','GBK',"本地开发平台最多只能有$appname 个应用，你现在已经不能再创建应用了").$LocalSAE ;					break ;				}				if('sae' == $command[1] || 'storage'==$command[1])				{					echo iconv('UTF-8','GBK',"sae和storage是本地环境的关键字，不能创建这两个名字的应用").$LocalSAE ;					break ;				}				$ret = $local_sae->create_app($command[1]) ;				if($ret == -1)				{					echo iconv('UTF-8','GBK',"应用名称已经存在").$LocalSAE ;					break ;				}				$local_sae->now_app_name = $command[1] ;				$local_sae->addhost($command[1]) ;				//$local_sae->restart_apache() ;				echo iconv('UTF-8','GBK',"应用创建成功").$LocalSAE ;			}			else if(count($command) == 1)				echo iconv('UTF-8','GBK','参数错误，必须指定要创建的应用名称').$LocalSAE ;			else				echo iconv('UTF-8','GBK','参数错误，每一次只能创建一个应用，请检查参数').$LocalSAE ;			break ;		case 'dapp':			if(count($command)==1)				echo iconv('UTF-8','GBK','参数错误，必须指定要删除的应用名称').$LocalSAE ;			else if(count($command) == 2)			{				if(!array_key_exists($command[1],$local_sae->app_dbnum))				{					echo iconv('UTF-8','GBK','指定的应用名称不存在，请检查').$LocalSAE ;					break ;				}								if(array_key_exists($command[1],$local_sae->svn_operat_app) == true)				{					echo iconv('UTF-8','GBK','这个应用通过svn操作过，不能删除，如果要删除这个应用可以关闭本地开发环境之后重新启动本地开发环境来完成。').$LocalSAE ;					break ;				}								$local_sae->delhost($command[1]) ;				$local_sae->delete_app($command[1]) ;								if($local_sae->now_app_name == $command[1])					$local_sae->now_app_name = '' ;				$local_sae->restart_apache() ;				echo iconv('UTF-8','GBK','删除成功').$LocalSAE ;			}			else				echo iconv('UTF-8','GBK','参数错误，每一次只能删除一个应用，请检查参数').$LocalSAE ;			break ;		case 'sapps':			foreach($local_sae->app_dbnum as $app=>$num)			{				echo $num."     ".$app."\n\n" ;			}			if(count($local_sae->app_dbnum) == 0)				echo "\n\n" ;			echo "LocalSAE> " ;			break ;		case 'sapp':			if($local_sae->now_app_name == '')			{					echo iconv('UTF-8','GBK','当前没有选择应用，可以使用use命令来选择一个应用进行操作').$LocalSAE ;				break ;			}			else				echo $local_sae->now_app_name.$LocalSAE ;			break ;		case 'use':			if(count($command) == 1)			{				echo iconv('UTF-8','GBK','参数错误，没有输入要选择的应用名称').$LocalSAE ;				break ;			}			else if(count($command) > 2)			{				echo iconv('UTF-8','GBK','参数错误，use命令只能接受一个参数').$LocalSAE ;				break ;			}			else			{				if(!array_key_exists($command[1],$local_sae->app_dbnum))				{					echo iconv('UTF-8','GBK','指定的应用名称不存在，请检查').$LocalSAE ;					break ;					}				$local_sae->now_app_name = $command[1] ;				echo iconv('UTF-8','GBK','已切换当前应用').$LocalSAE  ;			}			break ;		case 'cstorage':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($command)<2)				echo iconv('UTF-8','GBK','参数错误，必须指定要创建的storage名称').$LocalSAE ;			else if(count($command) == 2)			{				if(preg_match("/^[a-zA-Z0-9]{4,18}$/",$command[1]) != 1)				{					echo iconv('UTF-8','GBK',"storage名称中只能有数字和字母，并且应用名长度应该在4-18个字符之间").$LocalSAE ;					break ;				}				if(in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['storage']))				{					echo iconv('UTF-8','GBK',"要创建的storage已经存在").$LocalSAE ;					break ;				}				$stornum = 0 ;				$allstornum = 0 ;				$local_sae->get_storage_num($local_sae->now_app_name,$stornum,$allstornum) ;				if($stornum >= APPSTORAGENUM)				{					echo iconv('UTF-8','GBK','每个应用最多只能有'.APPSTORAGENUM.'个storage').$LocalSAE ;					break ;				}				if($allstornum >= ALLSTORAGENUM)				{					echo iconv('UTF-8','GBK','所有应用的storage数目不能超过'.ALLSTORAGENUM.'个').$LocalSAE ;					break ;				}				$local_sae->create_storage($command[1]);				echo iconv('UTF-8','GBK','storage创建成功').$LocalSAE ;			}			else				echo iconv('UTF-8','GBK','参数错误，每一次只能创建一个storage，您输入了多个参数，请检查参数').$LocalSAE ;			break ;		case 'dstorage':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($command)<2)				echo iconv('UTF-8','GBK','参数错误，必须指定要删除的storage名称').$LocalSAE ;			else if(count($command) == 2)			{				if(!in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['storage']))				{					echo iconv('UTF-8','GBK',"没有您要删除的storage，请检查storage名称是否正确").$LocalSAE ;					break ;				}				$local_sae->delete_storage($command[1]) ;				echo iconv('UTF-8','GBK','删除storage成功').$LocalSAE ;			}			else				echo iconv('UTF-8','GBK','参数错误，每一次只能删除一个storage，您输入了多个参数，请检查参数').$LocalSAE ;			break ;		case 'sstorages':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['storage']) > 0)			{				echo "\n" ;				foreach($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['storage'] as $value)				{					echo $value."\n" ;				}				echo $LocalSAE ;			}			else				echo iconv('UTF-8','GBK','当前应用还没有storage，可以使用cstorage命令来创建一个storage').$LocalSAE ;			break ;		case 'cversion':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($command)<2)				echo iconv('UTF-8','GBK','参数错误，必须指定要创建的版本号').$LocalSAE ;			else if(count($command) == 2)			{				if(!is_numeric($command[1]) || $command[1]<0 || $command[1]>2147483647)				{					echo iconv('UTF-8','GBK','版本号输入错误，只允许1到2147483647之间的整数').$LocalSAE ;					break ;				}				if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) >= APPNUM)				{					echo iconv('UTF-8','GBK','一个应用最多可以部署'.APPNUM.'个版本，您已经不能再部署版本了').$LocalSAE  ;					break ;				}				if(in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']))				{					echo iconv('UTF-8','GBK','要创建的版本已存在').$LocalSAE  ;					break ;				}				else				{					$local_sae->create_version($command[1]) ;					$local_sae->addhost($local_sae->now_app_name,$command[1]) ;					$local_sae->restart_apache() ;					echo iconv('UTF-8','GBK','创建版本成功').$LocalSAE ;				}			}			else				echo iconv('UTF-8','GBK','参数错误，每一次只能创建一个版本，您输入了多个参数，请检查参数').$LocalSAE ;			break ;		case 'dversion':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($command)<2)				echo iconv('UTF-8','GBK','参数错误，必须指定要删除的版本号').$LocalSAE ;			else if(count($command) == 2)			{				if(!in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']))					echo iconv('UTF-8','GBK','要删除的版本不存在').$LocalSAE  ;				else if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app)==true && array_key_exists($command[1],$local_sae->svn_operat_app[$local_sae->now_app_name])==true)				{					echo iconv('UTF-8','GBK','这个版本通过svn操作过，不能删除，如果要删除这个应用可以关闭本地开发环境之后重新启动本地开发环境来完成。').$LocalSAE ;					break ;				}				else if($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['default']==$command[1])					echo iconv('UTF-8','GBK','默认版本不能删除').$LocalSAE  ;				else				{					$local_sae->delhost($local_sae->now_app_name,$command[1]) ;					$local_sae->delete_version($command[1]) ;					$local_sae->restart_apache() ;					echo iconv('UTF-8','GBK','删除版本成功').$LocalSAE ;				}			}			else				echo iconv('UTF-8','GBK','参数错误，每一次只能删除一个版本，您输入了多个参数，请检查参数').$LocalSAE ;			break ;		case 'defver':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($command)<2)				echo iconv('UTF-8','GBK','参数错误，必须指定要一个版本号作为默认版本').$LocalSAE ;			else if(count($command) == 2)			{				if(!in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']))					echo iconv('UTF-8','GBK','指定的版本号不存在').$LocalSAE  ;				else				{					$local_sae->set_default_varsion($command[1]) ;					$local_sae->restart_apache() ;					echo iconv('UTF-8','GBK','设置默认版本成功').$LocalSAE ;				}			}			else				echo iconv('UTF-8','GBK','参数错误，只能设定一个版本号为默认版本，您输入了多个参数，请检查参数').$LocalSAE ;			break ;		case 'sversions':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) > 0)			{				foreach($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version'] as $value)				{					echo $value."  " ;				}				echo $LocalSAE ;			}			else				echo iconv('UTF-8','GBK','当前应用还没有创建版本，请先创建版本').$LocalSAE ;			break ;		case 'sversion':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if( $local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['default']!='' )				echo $local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['default'].$LocalSAE ;			else				echo iconv('UTF-8','GBK','当前应用还没有默认版本，请选择默认版本').$LocalSAE ;			break ;		case 'changeuser':			if($local_sae->change_user() !== false)				echo iconv('UTF-8','GBK','用户名密码设置成功')."\n" ;			echo "LocalSAE> " ;			break ;		case 'chickoutall':		case 'coa':			$local_sae->chickoutall() ;			$local_sae->restart_apache() ;			echo $LocalSAE ;			break ;		case 'chickout':		case 'co':			if(count($command)==1)			{				echo iconv('UTF-8','GBK','请输入需要checkout的应用名称。').$LocalSAE ;				break ;			}			else if(count($command) == 2)			{				if($local_sae->chickout($command[1]) == true)					$local_sae->restart_apache() ;				echo $LocalSAE ;			}			else if(count($command) == 3)			{				$temp = explode('=',$command[2],2) ;				$version = $temp[1] ;				if(!is_numeric($version) || $version<0 || $version>2147483647)				{					echo iconv('UTF-8','GBK','版本号输入错误，只允许1到2147483647之间的整数').$LocalSAE ;					break ;				}				if($local_sae->chickout_version($command[1],$version))					$local_sae->restart_apache() ;				echo $LocalSAE ;			}			else			{				echo iconv('UTF-8','GBK','输入的参数有误，请检查').$LocalSAE ;			}			break ;		case 'add':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$addarr = array() ;			if(count($command) == 1)			{				echo iconv('UTF-8','GBK','请您输入您需要添加的文件').$LocalSAE ;				break ;			}			$local_sae->get_command_version_files($command,$version,$addarr) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			$ret = $local_sae->chick_command_files($addarr,$verpath);			if($ret !==true)			{				echo iconv('UTF-8','GBK',$local_sae->now_app_name.'应用的'.$version."版本中没有".$ret.'文件，请检查').$LocalSAE ;				break ;			}			if($local_sae->add($addarr) == true)			{				if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)					$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;				$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;				echo iconv('UTF-8','GBK','添加文件成功，使用commit命令可以将文件上传到线上代码库中').$LocalSAE ;			}			else				echo iconv('UTF-8','GBK','添加文件失败').$LocalSAE ;			break ;		case 'addall':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$local_sae->get_command_version_files($command,$version,$addarr) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			$addfiles = $local_sae->addall($verpath) ;			if($addfiles === false)			{				echo iconv('UTF-8','GBK','添加文件失败').$LocalSAE ;				break ;			}			echo iconv('UTF-8','GBK',"添加文件成功，添加的文件有:\n") ;			print_r($addfiles) ;			if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)				$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;			$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;			echo iconv('UTF-8','GBK','需要用commit命令提交代码后才能上传到线上代码库中').$LocalSAE ;			break ;		case 'saddall':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$local_sae->get_command_version_files($command,$version,$addarr) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			$addfiles = $local_sae->get_addall($verpath) ;			if($addfiles === false)			{				echo iconv('UTF-8','GBK','获取全部添加文件失败').$LocalSAE ;			}			if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)				$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;			$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;			print_r($addfiles) ;			echo $LocalSAE ;			break ;		case 'delete':		case 'del':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$addarr = array() ;			$local_sae->get_command_version_files($command,$version,$addarr) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			$ret = $local_sae->chick_command_files($addarr,$verpath);			if($ret !==true)			{				echo iconv('UTF-8','GBK',$local_sae->now_app_name.'应用的'.$version."版本中没有".$ret.'文件，请检查').$LocalSAE ;				break ;			}			if($local_sae->delete($addarr) === false)				echo iconv('UTF-8','GBK','删除文件失败').$LocalSAE ;			else			{				if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)					$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;				$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;				echo iconv('UTF-8','GBK','删除文件成功，需要用commit命令提交代码后才能上传到线上代码库中').$LocalSAE ;			}			break ;		case 'delall':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$local_sae->get_command_version_files($command,$version,$coms) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			$delfile = $local_sae->delall($verpath) ;			if($delfile === false)			{				echo iconv('UTF-8','GBK','删除文件失败').$LocalSAE ;				break ;			}						if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)				$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;			$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;						echo iconv('UTF-8','GBK','删除的文件有\n');			print_r($delfile) ;			echo iconv('UTF-8','GBK',"删除文件成功").$LocalSAE ;			break ;		case 'sdelall':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$local_sae->get_command_version_files($command,$version,$coms) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			$dels = $local_sae->show_delall($verpath) ;			if($dels === false)			{				echo iconv('UTF-8','GBK','获取删除的文件失败').$LocalSAE ;				break ;			}			print_r($dels) ;			echo $LocalSAE ;			if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)				$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;			$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;			break ;		case 'update':		case 'up':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$local_sae->get_command_version_files($command,$version,$coms) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			if($local_sae->update($verpath) == false)				echo iconv('UTF-8','GBK','update失败').$LocalSAE ;			else			{				echo iconv('UTF-8','GBK','update成功').$LocalSAE ;				if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)					$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;				$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;			}			break ;		case 'stat':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$coms = array() ;			$local_sae->get_command_version_files($command,$version,$coms) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			$stat = $local_sae->status($verpath) ;			if( $stst === false )				echo iconv('UTF-8','GBK',"获取状态失败").$LocalSAE ;			else			{				$local_sae->show_status($stat) ;				echo $LocalSAE ;				if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)					$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;				$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;			}			break ;		case 'commit':		case 'ci':			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == 0)			{				echo iconv('UTF-8','GBK','您当前的应用没有版本，请您先试用checkout 来下载代码').$LocalSAE ;				break ;			}			$version = NULL ;			$coms = array() ;			$log = NULL ;			$local_sae->get_command_version_files($command,$version,$coms) ;			if(in_array($version,$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']) == false)			{				echo iconv('UTF-8','GBK','您输入的版本号不存在').$LocalSAE ;				break ;			}			$verpath = realpath($local_sae->rootdir.'/'.$local_sae->now_app_name.'/'.$version) ;			if($coms[0] != '-m')			{				echo iconv('UTF-8','GBK','必须使用-m参数来指定日志内容').$LocalSAE ;				break ;			}			if(count($com)>1 && $com[1][0] == '"')			{				for($i=1;$i<count($com);++$i)				{					$log .= $com[$i] ;					if($com[$i][count($com[$i])]=='"')						break ;				}			}			else if(count($com)>1 && $com[1][0] != '"')			{				$log = $com[1] ;			}			else 				$log = NULL ;			if($local_sae->commit($log,$verpath) == false)				echo iconv('UTF-8','GBK','commit失败').$LocalSAE ;			else			{				echo iconv('UTF-8','GBK','commit成功').$LocalSAE ;				if(array_key_exists($local_sae->now_app_name,$local_sae->svn_operat_app) == false)					$local_sae->svn_operat_app[$local_sae->now_app_name] = array() ;				$local_sae->svn_operat_app[$local_sae->now_app_name][$version] = true ;			}			break ;		case "upconfig":			if($local_sae->now_app_name == '')			{					echo iconv('UTF-8','GBK','当前没有选择应用，可以使用use命令来选择一个应用进行操作').$LocalSAE ;				break ;			}			if(count($command)<2)				echo iconv('UTF-8','GBK','参数错误，必须指定要更新的版本号').$LocalSAE ;			else if(!in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']))				echo iconv('UTF-8','GBK','要更新的版本不存在，请确认').$LocalSAE  ;			else			{				if($local_sae->parsedToConfig($local_sae->rootdir.DIRECTORY_SEPARATOR.$local_sae->now_app_name.DIRECTORY_SEPARATOR.$command[1],$local_sae->now_app_name,$command[0]))					echo iconv('UTF-8','GBK','config.yaml文件更新成功。').$LocalSAE ;				else					echo iconv('UTF-8','GBK','config.yaml文件更新失败，请重试。').$LocalSAE ;			}			break ;		case "upallconfig":			if($local_sae->now_app_name == '')			{					echo iconv('UTF-8','GBK','当前没有选择应用，可以使用use命令来选择一个应用进行操作').$LocalSAE ;				break ;			}			foreach($local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version'] as $version)			{				$local_sae->parsedToConfig($local_sae->rootdir.DIRECTORY_SEPARATOR.$local_sae->now_app_name.DIRECTORY_SEPARATOR.$version,$local_sae->now_app_name,$version) ;			}			echo iconv('UTF-8','GBK',"$local_sae->now_app_name 应用的config.yaml文件更新成功。").$LocalSAE ;			break ;		case "saever":			$local_version = getMessage('version') ;			echo iconv('UTF-8','GBK',"本地开发环境当前的版本是：$local_version") ;			echo $LocalSAE ;			break ;		case "restart":			$redis_ret = $local_sae->stop_redis() ;			$apache_ret = $local_sae->stop_apache() ;			$local_sae->closehost() ;			if($redis_ret == false || $apache_ret==false)			{				$local_sae->shutdown_function("redis或者apache的端口没有释放，请稍后再启动本地开发环境") ;			}						echo iconv('UTF-8','GBK',"\n\nSAE本地模拟开发环境正在启动...").PHP_EOL;			unset($local_sae) ;			$local_sae = new Loacl_SAE() ;			$local_sae->local_upgrade() ;			$local_sae->get_disable_function_class() ;			$local_sae->chick_config() ;			$local_sae->start_apache() ;			$local_sae->start_redis() ;			$redis_path = realpath(__DIR__. DIRECTORY_SEPARATOR .'..'.DIRECTORY_SEPARATOR."bin". DIRECTORY_SEPARATOR .'redis-2.0.2') ;			$temp_dir = sys_get_temp_dir() ;			$temp_dir = trim($temp_dir) ;			run('"'.$redis_path. DIRECTORY_SEPARATOR .'redis-server.exe" '.$temp_dir.DIRECTORY_SEPARATOR.'redis.conf',"正在启动Redis服务...\n",$redisresources,true);			$i = 0 ;			while(!$local_sae->chickPort($local_sae->confs["redis_port"]) && $i<90)			{				sleep(1) ;				$i++ ;			}			if($i >= 90)				{				$local_sae->shutdown_function("redis服务启动失败，请您稍后再试。") ;			}			unset($i) ;			echo iconv('UTF-8','GBK',"redis服务启动成功\n\n") ;			$local_sae->start_local_env() ;			echo $LocalSAE ;			break ;		case 'apachestop':			if($local_sae->apache_sae->test_SAE_Local_Apache_is_Run())			{				$local_sae->stop_apache() ;			}			else				echo iconv('UTF-8','GBK',"当前apache服务为关闭状态\n") ;			echo $LocalSAE ;			break ;		case 'apachestart':			echo iconv('UTF-8','GBK',"正在启动apache服务...\n") ;			if($local_sae->apache_sae->test_SAE_Local_Apache_is_Run())			{				echo iconv('UTF-8','GBK',"当前apache服务为开启状态\n") ;				echo $LocalSAE ;				break ;			}			else			{				if(!$local_sae->chick_apache_port() )				{					echo $LocalSAE ;					break ;				}				if($local_sae->start_apache2() == false)				{					echo iconv('UTF-8','GBK',"apache服务启动失败，请重试。\n") ;					echo $LocalSAE ;					break ;				}			}			echo iconv('UTF-8','GBK',"apache服务启动成功...\n") ;			echo $LocalSAE ;			break ;		case 'apacherestart':			echo iconv('UTF-8','GBK',"正在重启apache服务...\n") ;			if($local_sae->apache_sae->test_SAE_Local_Apache_is_Run())			{				$local_sae->restart_apache() ;			}			else			{				if(!$local_sae->chick_apache_port() )				{					echo iconv('UTF-8','GBK',"apache服务重启失败\n") ;					echo $LocalSAE ;					break ;				}				$local_sae->start_apache2() ;			}			echo iconv('UTF-8','GBK',"apache服务重启成功\n") ;			echo $LocalSAE ;			break ;		case 'apachestat':			if($local_sae->apache_sae->test_SAE_Local_Apache_is_Run())				echo iconv('UTF-8','GBK',"apache服务正在运行") ;			else				echo  iconv('UTF-8','GBK',"apache服务已经停止") ;			echo $LocalSAE ;			break ;		case 'openhost':			$local_sae->openhost() ;			echo iconv('UTF-8','GBK',"添加host成功成功").$LocalSAE ;			break ;		case 'closehost':			$local_sae->closehost() ;			echo iconv('UTF-8','GBK',"删除host成功成功").$LocalSAE ;			break ;		case 'addhost' :			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($command)==1)			{				$local_sae->addhost($local_sae->now_app_name) ;				echo iconv('UTF-8','GBK',"添加应用".$local_sae->now_app_name."的host成功").$LocalSAE ;			}			else if(count($command)==2)			{				if(!in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']))				{					echo iconv('UTF-8','GBK','您选择的版本不存在').$LocalSAE  ;					break ;				}				$local_sae->addhost($local_sae->now_app_name,$command[1]) ;				echo iconv('UTF-8','GBK',"添加应用".$local_sae->now_app_name."的版本".$command[1]."的host成功").$LocalSAE ;			}			else			{				echo iconv('UTF-8','GBK','每次只能添加一个版本的host').$LocalSAE ;			}			break ;		case 'delhost' :			if($local_sae->now_app_name == '')			{				echo iconv('UTF-8','GBK','请选择一个应用在进行操作，可以使用use命令来选择一个应用').$LocalSAE ;				break ;			}			if(count($command)==1)			{				$local_sae->delhost($local_sae->now_app_name) ;				echo iconv('UTF-8','GBK',"删除应用".$local_sae->now_app_name."的host成功").$LocalSAE ;			}			else if(count($command)==2)			{				if(!in_array($command[1],$local_sae->local_env[$local_sae->app_dbnum[$local_sae->now_app_name]]['version']))				{					echo iconv('UTF-8','GBK','您选择的版本不存在').$LocalSAE  ;					break ;				}				$local_sae->delhost($local_sae->now_app_name,$command[1]) ;				echo iconv('UTF-8','GBK',"删除应用".$local_sae->now_app_name."的版本".$command[1]."的host成功").$LocalSAE ;			}			else			{				echo iconv('UTF-8','GBK','每次只能删除一个版本的host').$LocalSAE ;			}			break ;		case 'exit':		case 'quit':			$local_sae->stop_redis() ;			$local_sae->stop_apache() ;			$local_sae->closehost() ;			fclose($stdin) ;			die(iconv('UTF-8','GBK',"bye\n"));			break;		case "uninstall":			$local_sae->uninstall_local() ;			fclose($stdin) ;			die(iconv('UTF-8','GBK',"您已经清空了本地开发环境的临时文件，并卸载了本地开发环境的Apache服务\n"));			break ;		case 'clear':			$temp = exec('chcp') ;			$ttt = explode(':',$temp) ;			$chcp = trim($ttt[1]) ;			exec("chcp 437 >nul") ;			exec("chcp $chcp >nul") ;			echo "LocalSAE> " ;			break ;		case 'help':			if(count($command)==1)				$local_sae->show_help() ;			else if(count($command) > 2)				echo iconv('UTF-8','GBK','help命令后面只能有一个参数') ;			else			{				$local_sae->show_help($command[1]) ;			}			echo $LocalSAE ;			break ;		default:			echo iconv('UTF-8','GBK','命令不存在，请检查') ;			echo $LocalSAE ;			break ;		}	}}?>